---
layout: layouts/base.njk
isMainPage: true
isLandingPage: true
hasInfoOverlay: true
hasSideNav: false
hasVimeoPlayer: true
---

<style>
    /* Landing page specific styles */

    /* Remove body margins and ensure full bleed */
    body {
        margin: 0;
        padding: 0;
        overflow-x: hidden;
        background: #000;
    }

    /* Full-screen immersive layout */
    html {
        scroll-behavior: smooth;
        margin: 0;
        padding: 0;
        background: #000;
    }

    #mainContent {
        scroll-snap-type: y mandatory;
        overflow-y: scroll;
        height: 100vh;
        margin: 0 !important;
        padding: 0;
        -webkit-overflow-scrolling: touch;
    }

    main {
        margin-top: 0 !important;
    }

    .fullscreen-container {
        margin: 0;
        padding: 0;
    }

    .fullscreen-section {
        position: relative;
        width: 100vw;
        height: 100vh;
        scroll-snap-align: start;
        scroll-snap-stop: always;
        overflow: hidden;
        margin: 0;
        padding: 0;
        left: 0;
        background: #000;
    }

    /* Remove all hover effects - override global styles */
    .fullscreen-section:hover {
        opacity: 1 !important;
    }

    .fullscreen-section a:hover {
        opacity: 1 !important;
    }

    .fullscreen-section:hover .fullscreen-video-bg,
    .fullscreen-section:hover .fullscreen-text-overlay {
        opacity: 1 !important;
    }

    .fullscreen-video-bg:hover {
        opacity: 1 !important;
        filter: none !important;
    }

    .fullscreen-video-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 1;
        pointer-events: none;
        min-width: 100%;
        min-height: 100%;
    }

    .fullscreen-text-overlay {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 2;
    }

    .fullscreen-text-overlay h3 {
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%) rotate(180deg);
        padding: 0 20px;
        font-size: 12px;
        font-weight: 400;
        margin: 0;
        letter-spacing: 0.05em;
        color: #fff;
        writing-mode: vertical-rl;
        white-space: nowrap;
    }

    .fullscreen-text-overlay p {
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        padding: 0 20px;
        font-size: 12px;
        margin: 0;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: #fff;
        writing-mode: vertical-rl;
        white-space: nowrap;
    }

    .play-button {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 3;
        opacity: 0.9;
        transition: all 0.3s ease;
        pointer-events: none;
    }

    .fullscreen-section:hover .play-button {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.1);
    }

    .play-button svg {
        width: 20px;
        height: 20px;
        fill: #fff;
        margin-left: 3px;
    }

    .scroll-button-container {
        position: fixed;
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        cursor: pointer;
        transition: opacity 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0;
    }

    .scroll-button-container:hover {
        opacity: 0.6;
    }

    .scroll-button-text {
        color: #fff;
        font-size: 12px;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        font-weight: 400;
        line-height: 1;
    }

    .down-arrow {
        width: 30px;
        height: 30px;
    }

    .down-arrow svg {
        width: 100%;
        height: 100%;
        stroke: #fff;
        fill: none;
        stroke-width: 1;
    }

    /* Modal Overlay Styles */
    .video-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.95);
        z-index: 9999;
        display: none !important;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
        overflow-y: auto;
        padding: 40px 0;
    }

    .video-modal.active {
        display: flex !important;
        opacity: 1;
    }

    .modal-content-wrapper {
        width: 90vw;
        max-width: 1800px;
        background: #000;
        padding: 60px 10px;
        position: relative;
        margin: auto;
    }

    .modal-project-header {
        margin-bottom: 32px;
        display: flex;
        justify-content: space-between;
        align-items: baseline;
    }

    .modal-project-title {
        font-family: 'Tonka', sans-serif;
        font-size: 12px;
        font-weight: 400;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: #fff;
        margin: 0;
    }

    .modal-project-subtitle {
        font-family: 'Tonka', sans-serif;
        font-size: 12px;
        font-weight: 400;
        letter-spacing: 0.1em;
        color: #fff;
        margin: 0;
    }

    .video-modal-content {
        position: relative;
        width: 100%;
        height: 0;
        padding-bottom: 41.78%; /* 2.39:1 aspect ratio */
        margin-bottom: 48px;
        background: #000;
    }

    .video-modal-content iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
    }

    .modal-project-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 64px;
    }

    .modal-details-left,
    .modal-details-right {
        max-width: 75ch;
    }

    .modal-project-details p {
        font-family: 'Tonka', sans-serif;
        font-size: 12px;
        font-weight: 400;
        line-height: 1.8;
        color: #fff;
        margin-bottom: 24px;
    }

    .modal-project-details strong {
        font-weight: 400;
        color: #fff;
    }

    .modal-reviews {
        margin-top: 48px;
        text-align: center;
    }

    .modal-reviews h3 {
        font-family: 'Tonka', sans-serif;
        font-size: 12px;
        font-weight: 400;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        color: #fff;
        margin-bottom: 1.5rem;
    }

    .modal-review-links {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
    }

    .modal-review-link {
        font-family: 'Tonka', sans-serif;
        font-size: 12px;
        font-weight: 400;
        line-height: 1.8;
        color: #fff;
        text-decoration: none;
        transition: opacity 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .modal-review-link:hover {
        opacity: 0.6;
    }

    .modal-review-link::before {
        content: 'â€¢';
        flex-shrink: 0;
    }

    .modal-close {
        position: fixed;
        top: 40px;
        right: 40px;
        width: 40px;
        height: 40px;
        cursor: pointer;
        z-index: 10000;
        opacity: 0.7;
        transition: opacity 0.3s ease;
    }

    .modal-close:hover {
        opacity: 1;
    }

    .modal-close::before,
    .modal-close::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 30px;
        height: 2px;
        background: #fff;
    }

    .modal-close::before {
        transform: translate(-50%, -50%) rotate(45deg);
    }

    .modal-close::after {
        transform: translate(-50%, -50%) rotate(-45deg);
    }

    /* Mobile responsive */
    @media (max-width: 768px) {
        /* Custom mobile header for landing page */
        .landing-page-header {
            padding: 16px 16px !important;
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
        }

        /* Show left and right nav on mobile for landing page */
        .landing-page-header .header-left,
        .landing-page-header .header-right {
            display: block !important;
            flex: 0 0 auto !important;
            padding: 0 !important;
            margin: 0 !important;
        }

        .landing-page-header .header-left {
            text-align: left !important;
        }

        .landing-page-header .header-right {
            text-align: right !important;
        }

        /* Center title in the middle */
        .landing-page-header .header-center {
            flex: 1 1 auto !important;
            text-align: center !important;
            padding: 0 20px !important;
            margin: 0 !important;
            order: 0 !important;
        }

        .landing-page-header .header-center h1 {
            text-align: center !important;
        }

        /* Ensure header text is white on landing page */
        .landing-page-header,
        .landing-page-header *,
        .landing-page-header h1,
        .landing-page-header .nav-link {
            color: #fff !important;
        }

        /* Hide INFO text that's too long, show INFO instead */
        .landing-page-header .info-full {
            display: none !important;
        }

        .landing-page-header .info-short {
            display: inline !important;
        }

        /* Hamburger menu - white on dark background (landing page) */
        .hamburger-btn span {
            background: #fff !important;
        }

        /* Keep hamburger white when active (X) initially */
        .hamburger-btn.active span {
            background: #fff !important;
        }

        /* When menu opens, hamburger turns black (on white menu background) */
        body.menu-open .hamburger-btn span {
            background: #000 !important;
        }

        /* When menu opens, header text turns black */
        body.menu-open header,
        body.menu-open header *,
        body.menu-open header h1,
        body.menu-open .header-title-link,
        body.menu-open .header-title-link * {
            color: #000 !important;
        }

        html, body {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #mainContent {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow-y: scroll;
            -webkit-overflow-scrolling: touch;
        }

        .fullscreen-section {
            position: relative;
            width: 100vw;
            height: 100vh;
            min-height: 100vh;
        }

        .fullscreen-video-bg {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
            min-width: 100% !important;
            min-height: 100% !important;
        }

        .play-button {
            width: 45px;
            height: 45px;
        }

        .play-button svg {
            width: 18px;
            height: 18px;
        }

        .fullscreen-text-overlay h3 {
            font-size: 12px;
            padding: 0 15px;
        }

        .fullscreen-text-overlay p {
            font-size: 12px;
            padding: 0 15px;
        }

        .scroll-button-container {
            bottom: 15px;
            gap: 0;
        }

        .scroll-button-text {
            font-size: 12px;
        }

        .down-arrow {
            width: 24px;
            height: 24px;
        }

        .video-modal {
            padding: 0;
            height: calc(var(--vh, 1vh) * 100);
            align-items: flex-start;
        }

        .modal-content-wrapper {
            width: 100vw;
            padding: 80px 20px 60px;
            min-height: calc(var(--vh, 1vh) * 100);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            box-sizing: border-box;
        }

        .modal-project-header {
            flex-direction: column;
            gap: 8px;
            margin-bottom: 24px;
        }

        .video-modal-content {
            margin-bottom: 32px;
        }

        .modal-project-details {
            grid-template-columns: 1fr;
            gap: 32px;
        }

        .modal-close {
            top: 100px;
            right: 20px;
            width: 44px;
            height: 44px;
            z-index: 99999 !important;
            pointer-events: auto !important;
        }

        .modal-close::before,
        .modal-close::after {
            width: 20px;
            pointer-events: none;
        }
    }

    /* Mobile landscape orientation - move button even lower */
    @media (max-width: 768px) and (max-aspect-ratio: 13/9) {
        .scroll-button-container {
            bottom: 8px;
        }
    }

    @media (max-width: 926px) and (max-height: 428px) {
        .scroll-button-container {
            bottom: 8px;
        }

        .video-modal {
            align-items: flex-start !important;
            padding-top: 0 !important;
        }

        .modal-content-wrapper {
            padding: 50px 20px 30px !important;
            min-height: auto !important;
        }

        .modal-project-header {
            margin-bottom: 12px !important;
        }

        .video-modal-content {
            margin-bottom: 16px !important;
        }
    }
</style>

<!-- Main Content -->
<main id="mainContent">
    <!-- Full-Screen Sections -->
    <div class="fullscreen-container">
        {% set sectionIndex = 0 %}
        {% for slug in featuredProjects %}
            {% for project in projects.projects %}
                {% if project.slug == slug %}
                <!-- {{ project.title }} -->
                <section class="fullscreen-section" data-category="{{ project.category }}" id="section-{{ sectionIndex }}" data-modal-video="{{ project.vimeoId }}" style="cursor: pointer;">
                    <video class="fullscreen-video-bg" muted loop playsinline preload="none" poster="{{ project.thumbnail }}" data-src="{{ project.preview }}?v=2">
                    </video>
                    <div class="play-button">
                        <svg viewBox="0 0 24 24">
                            <polygon points="5,3 19,12 5,21"></polygon>
                        </svg>
                    </div>
                    <div class="fullscreen-text-overlay">
                        <h3>{{ project.title | safe }}</h3>
                        <p>{{ project.subtitle or project.category | capitalize }}</p>
                    </div>
                </section>
                {% set sectionIndex = sectionIndex + 1 %}
                {% endif %}
            {% endfor %}
        {% endfor %}
    </div>
</main>

<!-- Scroll Button (Fixed at bottom center) -->
<div class="scroll-button-container">
    <span class="scroll-button-text">SELECT PROJECTS</span>
    <div class="down-arrow">
        <svg viewBox="0 0 24 24">
            <polyline points="6 9 12 15 18 9"></polyline>
        </svg>
    </div>
</div>

<!-- Video Modal -->
<div class="video-modal" id="videoModal">
    <div class="modal-close" id="modalClose"></div>
    <div class="modal-content-wrapper">
        <!-- Project Header -->
        <div class="modal-project-header">
            <h2 class="modal-project-title" id="modalProjectTitle"></h2>
            <p class="modal-project-subtitle" id="modalProjectSubtitle"></p>
        </div>

        <!-- Video Player -->
        <div class="video-modal-content" id="modalVideoContainer">
            <!-- iframe will be created dynamically to prevent history pollution -->
        </div>

        <!-- Project Details -->
        <div class="modal-project-details">
            <div class="modal-details-left" id="modalDetailsLeft">
            </div>
            <div class="modal-details-right" id="modalDetailsRight">
            </div>
        </div>

        <!-- Reviews Section -->
        <div class="modal-reviews" id="modalReviews" style="display: none;">
            <h3>Reviews</h3>
            <div class="modal-review-links" id="modalReviewLinks">
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
    // Fix iOS Safari viewport height issue
    function setViewportHeight() {
        const methods = {
            visualViewport: window.visualViewport?.height,
            innerHeight: window.innerHeight,
            screenHeight: window.screen.height,
            screenAvailHeight: window.screen.availHeight,
            clientHeight: document.documentElement.clientHeight
        };

        const actualHeight = Math.max(methods.innerHeight, methods.screenAvailHeight * 0.85);
        const vh = actualHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);

        if (window.innerWidth <= 768) {
            document.documentElement.style.height = `${actualHeight}px`;
            document.body.style.height = `${actualHeight}px`;
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.style.height = `${actualHeight}px`;
            }

            document.querySelectorAll('.fullscreen-section').forEach(section => {
                section.style.height = `${actualHeight}px`;
                section.style.minHeight = `${actualHeight}px`;

                const video = section.querySelector('.fullscreen-video-bg');
                if (video) {
                    video.style.position = 'absolute';
                    video.style.top = '0';
                    video.style.left = '0';
                    video.style.width = '100vw';
                    video.style.height = `${actualHeight}px`;
                    video.style.minHeight = `${actualHeight}px`;
                    video.style.minWidth = '100vw';
                    video.style.maxWidth = 'none';
                    video.style.maxHeight = 'none';
                    video.style.objectFit = 'cover';
                }
            });
        }
    }

    setViewportHeight();
    window.addEventListener('resize', setViewportHeight);
    window.addEventListener('orientationchange', setViewportHeight);

    if (window.visualViewport) {
        window.visualViewport.addEventListener('resize', setViewportHeight);
        window.visualViewport.addEventListener('scroll', setViewportHeight);
    }

    setTimeout(setViewportHeight, 100);
    setTimeout(setViewportHeight, 500);
    setTimeout(setViewportHeight, 1000);

    // Simple modal with browser back button support
    document.addEventListener('DOMContentLoaded', function() {
        setViewportHeight();

        // CLEAN UP: If page loaded with modal state, clear it
        if (window.location.search.includes('modal=')) {
            window.location.replace(window.location.pathname);
            return;
        }

        const modal = document.getElementById('videoModal');
        const modalClose = document.getElementById('modalClose');
        const modalVideoContainer = document.getElementById('modalVideoContainer');
        let modalIsOpen = false;
        let currentIframe = null;

        // Project data from 11ty
        const projectData = {
            {% for slug in featuredProjects %}
            {% for project in projects.projects %}
            {% if project.slug == slug %}
            '{{ project.vimeoId }}': {
                title: '{{ project.title | safe }}',
                subtitle: '{{ project.subtitle | safe }}',
                detailsLeft: [
                    {% for detail in project.detailsLeft %}
                    ['{{ detail[0] }}', '{{ detail[1] }}']{% if not loop.last %},{% endif %}
                    {% endfor %}
                ],
                detailsRight: [
                    {% for detail in project.detailsRight %}
                    ['{{ detail[0] }}', '{{ detail[1] }}']{% if not loop.last %},{% endif %}
                    {% endfor %}
                ],
                reviews: [
                    {% if project.reviews %}
                    {% for review in project.reviews %}
                    { title: '{{ review.title }}', url: '{{ review.url }}' }{% if not loop.last %},{% endif %}
                    {% endfor %}
                    {% endif %}
                ]
            },
            {% endif %}
            {% endfor %}
            {% endfor %}
        };

        // Open modal
        function openModal(vimeoId) {
            modal.classList.add('active');
            document.body.classList.add('modal-open');
            document.body.style.overflow = 'hidden';

            // Populate project information if available
            const project = projectData[vimeoId];
            if (project) {
                document.getElementById('modalProjectTitle').textContent = project.title || '';
                document.getElementById('modalProjectSubtitle').textContent = project.subtitle || '';

                const detailsLeft = document.getElementById('modalDetailsLeft');
                const detailsRight = document.getElementById('modalDetailsRight');

                detailsLeft.innerHTML = '';
                detailsRight.innerHTML = '';

                project.detailsLeft.forEach(detail => {
                    const p = document.createElement('p');
                    p.innerHTML = `<strong>${detail[0]}:</strong> ${detail[1]}`;
                    detailsLeft.appendChild(p);
                });

                project.detailsRight.forEach(detail => {
                    const p = document.createElement('p');
                    p.innerHTML = `<strong>${detail[0]}:</strong> ${detail[1]}`;
                    detailsRight.appendChild(p);
                });

                // Populate reviews if available
                const modalReviews = document.getElementById('modalReviews');
                const modalReviewLinks = document.getElementById('modalReviewLinks');
                if (project.reviews && project.reviews.length > 0) {
                    modalReviewLinks.innerHTML = '';
                    project.reviews.forEach(review => {
                        const link = document.createElement('a');
                        link.href = review.url;
                        link.target = '_blank';
                        link.rel = 'noopener noreferrer';
                        link.className = 'modal-review-link';
                        link.textContent = review.title;
                        modalReviewLinks.appendChild(link);
                    });
                    modalReviews.style.display = 'block';
                } else {
                    modalReviews.style.display = 'none';
                }
            }

            // Create new iframe (prevents history pollution from previous iframe)
            currentIframe = document.createElement('iframe');
            currentIframe.id = 'modalVideoFrame';
            currentIframe.setAttribute('frameborder', '0');
            currentIframe.setAttribute('allow', 'autoplay; fullscreen; picture-in-picture');
            currentIframe.setAttribute('allowfullscreen', '');
            currentIframe.src = `https://player.vimeo.com/video/${vimeoId}?autoplay=1&muted=1&title=0&byline=0&portrait=0`;
            modalVideoContainer.appendChild(currentIframe);

            // Use Vimeo Player SDK to unmute
            setTimeout(() => {
                if (typeof Vimeo !== 'undefined') {
                    const player = new Vimeo.Player(currentIframe);
                    player.ready().then(() => {
                        player.setVolume(1).catch(() => {});
                    });
                }
            }, 100);

            modalIsOpen = true;

            // Push unique history state for back button support
            const timestamp = Date.now();
            const uniqueUrl = `${window.location.pathname}?modal=${timestamp}`;
            history.pushState({ modal: true, timestamp: timestamp }, '', uniqueUrl);
        }

        // Close modal
        function closeModal() {
            modal.classList.remove('active');
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';

            if (currentIframe) {
                currentIframe.src = '';
                modalVideoContainer.removeChild(currentIframe);
                currentIframe = null;
            }

            modalIsOpen = false;
        }

        // Click to open modal
        const modalElements = document.querySelectorAll('[data-modal-video]');
        modalElements.forEach(el => {
            el.addEventListener('click', function(e) {
                if (!e.target.closest('.scroll-button-container')) {
                    e.preventDefault();
                    e.stopPropagation();
                    openModal(this.dataset.modalVideo);
                }
            });
        });

        // Close button
        modalClose.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            if (modalIsOpen) {
                history.back();
            }
        });

        modalClose.addEventListener('touchend', (e) => {
            e.preventDefault();
            e.stopPropagation();
            if (modalIsOpen) {
                history.back();
            }
        });

        // Click outside
        modal.addEventListener('click', (e) => {
            if ((e.target === modal || e.target.classList.contains('video-modal')) && modalIsOpen) {
                history.back();
            }
        });

        // ESC key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && modalIsOpen) {
                history.back();
            }
        });

        // Browser back button support
        window.addEventListener('popstate', (e) => {
            if (modalIsOpen) {
                closeModal();
            }
        });

        // Scroll button navigation
        let currentSectionIndex = 0;
        const sections = document.querySelectorAll('.fullscreen-section');
        const totalSections = sections.length;
        const scrollButton = document.querySelector('.scroll-button-container');

        // Track current section with Intersection Observer
        const sectionObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const sectionId = entry.target.id;
                    const match = sectionId.match(/section-(\d+)/);
                    if (match) {
                        currentSectionIndex = parseInt(match[1]);

                        if (currentSectionIndex === totalSections - 1) {
                            scrollButton.style.display = 'none';
                        } else {
                            scrollButton.style.display = 'flex';
                        }
                    }
                }
            });
        }, {
            threshold: 0.5
        });

        sections.forEach(section => {
            sectionObserver.observe(section);
        });

        // Scroll button click handler
        scrollButton.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            const nextIndex = currentSectionIndex + 1;
            const nextSection = document.getElementById('section-' + nextIndex);
            if (nextSection) {
                nextSection.scrollIntoView({ behavior: 'smooth' });
            }
        });

        // Intersection Observer for video autoplay
        const videos = document.querySelectorAll('.fullscreen-video-bg');

        const videoObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const video = entry.target;

                if (entry.isIntersecting) {
                    if (video.dataset.src && !video.src) {
                        video.src = video.dataset.src;
                        video.load();
                    }
                    video.play().catch(() => {});
                } else {
                    video.pause();
                }
            });
        }, {
            threshold: 0.5
        });

        videos.forEach(video => {
            videoObserver.observe(video);
        });

        // Handle orientation change for mobile
        let orientationTimeout;
        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

        const handleOrientationChange = () => {
            clearTimeout(orientationTimeout);

            orientationTimeout = setTimeout(() => {
                const actualHeight = window.innerHeight;
                const actualWidth = window.innerWidth;

                document.querySelectorAll('.fullscreen-section').forEach(section => {
                    section.style.height = `${actualHeight}px`;
                    section.style.minHeight = `${actualHeight}px`;
                    section.style.width = `${actualWidth}px`;

                    const video = section.querySelector('.fullscreen-video-bg');
                    if (video) {
                        if (isSafari) {
                            video.style.objectFit = 'none';
                            video.style.width = 'auto';
                            video.style.height = 'auto';

                            void video.offsetHeight;

                            setTimeout(() => {
                                video.style.position = 'absolute';
                                video.style.top = '0';
                                video.style.left = '0';
                                video.style.width = '100%';
                                video.style.height = '100%';
                                video.style.objectFit = 'cover';
                                video.style.minWidth = '100%';
                                video.style.minHeight = '100%';
                            }, 10);
                        } else {
                            video.style.width = '100%';
                            video.style.height = '100%';
                            video.style.objectFit = 'cover';
                        }
                    }
                });

                if (!isSafari) {
                    videoObserver.disconnect();
                }

                videos.forEach(video => {
                    const rect = video.getBoundingClientRect();
                    const isVisible = (
                        rect.top < window.innerHeight &&
                        rect.bottom > 0 &&
                        rect.left < window.innerWidth &&
                        rect.right > 0
                    );

                    if (isVisible) {
                        if (video.dataset.src && !video.src) {
                            video.src = video.dataset.src;
                            video.load();
                        }

                        if (isSafari) {
                            video.play().catch(() => {
                                setTimeout(() => {
                                    video.play().catch(() => {
                                        setTimeout(() => {
                                            video.play().catch(() => {});
                                        }, 200);
                                    });
                                }, 100);
                            });
                        } else {
                            video.play().catch(() => {});
                        }
                    }

                    if (!isSafari) {
                        videoObserver.observe(video);
                    }
                });
            }, isSafari ? 500 : 300);
        };

        window.addEventListener('orientationchange', handleOrientationChange);

        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                if (window.innerWidth <= 768) {
                    handleOrientationChange();
                }
            }, 300);
        });

        // Hamburger menu functionality
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        const body = document.body;

        if (hamburgerBtn && mobileMenu) {
            hamburgerBtn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();

                const isOpen = mobileMenu.classList.contains('active');

                if (isOpen) {
                    mobileMenu.classList.remove('active');
                    hamburgerBtn.classList.remove('active');
                    body.classList.remove('menu-open');
                } else {
                    mobileMenu.classList.add('active');
                    hamburgerBtn.classList.add('active');
                    body.classList.add('menu-open');
                }
            });

            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (mobileMenu.classList.contains('active') &&
                    !mobileMenu.contains(e.target) &&
                    !hamburgerBtn.contains(e.target)) {
                    mobileMenu.classList.remove('active');
                    hamburgerBtn.classList.remove('active');
                    body.classList.remove('menu-open');
                }
            });
        }
    });
</script>
{% endblock %}
